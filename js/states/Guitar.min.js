function create_guitar_prompt(){var t=Vent.game.add.group(),e=Vent.game.add.graphics(0,0);e.inputEnabled=!0,e.beginFill(0,1),e.boundsPadding=0,e.drawRect(0,0,Vent.game.width,Vent.game.height-30),e.alpha=0,t.add(e);var a=Vent.game.add.graphics(0,0);a.beginFill(0,1),a.boundsPadding=0,a.drawRect(0,Vent.game.height/2-100,Vent.game.width,200),a.alpha=.5,t.add(a),text="Click the guitar to shred",hasTouch&&(text="Tap the guitar to shred"),winText=Vent.game.add.text(settings.WIDTH/2,settings.HEIGHT/2-40,text,h3_style_bold),winText.anchor.set(.5),t.add(winText),ContinueBt=Vent.game.add.sprite(settings.WIDTH/2,settings.HEIGHT/2+30,"square"),createBt(ContinueBt,"Continue",!1),ContinueBt.events.onInputUp.add(function(){t.visible=!1},this),t.add(ContinueBt.group),t.bringToTop=!0}function start_bg_bounce_tween(){bounce=Vent.game.add.tween(bgGame),bgGame.y=Vent.game.height/2,bounce.to({y:Vent.game.world.height/2+(200*Math.random()-100)},100,Phaser.Easing.Quadratic.In),bounce.onComplete.addOnce(back_bg_bounce_tween,this),bounce.start()}function back_bg_bounce_tween(){bounce=Vent.game.add.tween(bgGame),bounce.to({y:Vent.game.world.height/2},400,Phaser.Easing.Bounce.Out),bounce.start()}function start_guitar_bounce_tween(){bounce_guitar=Vent.game.add.tween(guitar),guitar.y=Vent.game.height/2,bounce_guitar.to({y:Vent.game.world.height/2+(100*Math.random()-50)},100,Phaser.Easing.Quadratic.In),bounce_guitar.onComplete.addOnce(back_guitar_bounce_tween,this),bounce_guitar.start()}function back_guitar_bounce_tween(){bounce_guitar=Vent.game.add.tween(guitar),bounce_guitar.to({y:Vent.game.world.height/2},400,Phaser.Easing.Bounce.Out),bounce_guitar.start()}function createGuitarWorldSettings(){Vent.game.world.setBounds(0,0,settings.WIDTH,settings.HEIGHT),Vent.game.stage.backgroundColor=0}function createGuitarUI(){createGuitarInputListeners(),createGuitarButtons()}function createGuitarInputListeners(){bgGame.events.onInputDown.add(function(){swipeCoordX=Vent.game.input.activePointer.x,swipeCoordY=Vent.game.input.activePointer.y},this),bgGame.events.onInputUp.add(function(){swipeCoordX2=Vent.game.input.activePointer.x,swipeCoordY2=Vent.game.input.activePointer.y},this)}function createGuitarButtons(){buttons=Vent.game.add.group();var t=Vent.game.add.sprite(Vent.game.width-29,29,"square");createBt(t,"icon-x",!1,"circle"),t.events.onInputUp.add(function(){guitarExit()}),buttons.add(t),buttons.add(t.label),createFrets()}function createFrets(){guitar=Vent.game.add.sprite(0,Vent.game.height/2,"guitar"),guitar.anchor.set(0,.5),buttons.add(guitar);var t=Vent.game.add.sprite(0,Vent.game.height/2,"square");createFret(t),t.events.onInputDown.add(function(){playGuitarAudio(chord4)}),buttons.add(t);var e=Vent.game.add.sprite(Vent.game.width/4,Vent.game.height/2,"square");createFret(e),e.events.onInputDown.add(function(){playGuitarAudio(chord2)}),buttons.add(e);var a=Vent.game.add.sprite(Vent.game.width/2,Vent.game.height/2,"square");createFret(a),a.events.onInputDown.add(function(){playGuitarAudio(chord3)}),buttons.add(a);var i=Vent.game.add.sprite(Vent.game.width/4*3,Vent.game.height/2,"square");createFret(i),i.events.onInputDown.add(function(){playGuitarAudio(chord1)}),buttons.add(i)}function createFret(t){t.width=t.w=Vent.game.width/4-1,t.height=t.h=250,t.anchor.set(0,.5),t.inputEnabled=!0,t.input.useHandCursor=!0,t.tint=16777215,t.bringToTop(),t.alpha=0,t.events.onInputOver.add(function(){t.alpha=.5}),t.events.onInputOut.add(function(){t.alpha=0}),t.events.onInputDown.add(function(){var e=16777215*Math.random();t.tint=e,t.height=Vent.game.height,Vent.game.add.tween(t).to({height:t.h,alpha:0},300,Phaser.Easing.Quadratic.Out,!0),t.alpha=1,create_bg_pop(Vent.game.input.activePointer.x,Vent.game.input.activePointer.y,e)}),t.events.onInputUp.add(function(){t.alpha=1})}function createTrailGraphic(){null!=graphics&&graphics.destroy(),graphics=Vent.game.add.graphics(0,0),graphics.lineStyle(1,16777215,1),graphics.moveTo(swipeCoordX,swipeCoordY),graphics.lineTo(Vent.game.input.activePointer.x,Vent.game.input.activePointer.y)}function removeTrailGraphic(){graphics.destroy(),graphics=null}function createTrail(){trail=Vent.game.add.emitter(Vent.game.input.activePointer.x,Vent.game.input.activePointer.y,200),trail.makeParticles(["smoke1","smoke1","smoke3"]),trail.setAlpha(1,0,1e3,Phaser.Easing.Cubic.Out),trail.setScale(1,.5,1,.5,1e3,Phaser.Easing.Cubic.Out),trail.minParticleSpeed.setTo(-10,-10),trail.maxParticleSpeed.setTo(10,10),trail.setRotation(0,0),trail.gravity=0,trail.start(!1,1e3,.5,200),updateTrail()}function startTrail(){createTrail()}function stopTrail(){trail.destroy(),trail=null}function updateTrail(){null!=trail&&(trail.emitX=Vent.game.input.activePointer.x,trail.emitY=Vent.game.input.activePointer.y,createTrailGraphic())}function createGuitarAudio(){chord1=Vent.game.add.audio("chord1"),chord2=Vent.game.add.audio("chord2"),chord3=Vent.game.add.audio("chord3"),chord4=Vent.game.add.audio("chord4"),chord5=Vent.game.add.audio("chord5"),drumLoop=Vent.game.add.audio("drumLoop"),drumLoop.loop=!0,drumLoop.volume=settings.VOLUME,drumLoop.play(),settings.LOOP=drumLoop}function createGuitarVisualization(){sb=Vent.game.add.sprite(Vent.game.width/2,Vent.game.height/2,"square"),sb.width=Vent.game.width,sb.height=Vent.game.height,sb.anchor.set(.5),sb.tint=4473924,bg_guitar_group.add(sb),bars_group=Vent.game.add.group()}function playGuitarAudio(t){start_bg_bounce_tween(),start_guitar_bounce_tween(),settings.SOUND_ON&&settings.VOLUME>0&&(t.play(),t.frame=0)}function guitarExit(){Vent.game.input.onDown.removeAll(),Vent.game.input.onUp.removeAll(),drumLoop.stop(),setTimeout(function(){hitTotal=0,destroyAllHits(),hasTouch?Vent.game.state.start("Finish"):Vent.game.stateTransition.to("Finish")},500)}function createHit(){if(hitTotal++,hitTotal===hitGoal)guitarExit();else{var t=Math.floor(Math.random()*hitSounds.length);playAudio(hitSounds[t]);var e=Math.floor(6*Math.random());0==e&&playAudio(cheer);var a=Vent.game.input.activePointer.x,i=Vent.game.input.activePointer.y;createSmoke(a,i),createSplinters(a,i),createWave(a,i),createBall(a,i),create_bg_pop(),sw.x=sw2.x=a,sw.y=sw2.y=i}}function create_bg_pop(){var t=Vent.game.add.sprite(Vent.game.width/2,Vent.game.height/2,"circle");t.width=t.height=0,t.anchor.set(.5),t.tint=16777215*Math.random(),t.alpha=1,bg_guitar_group.add(t),Vent.game.add.tween(t).to({width:900,height:900,alpha:0},1e3,Phaser.Easing.Exponential.Out,!0)}function createSplinters(t,e){var a=Vent.game.add.emitter(t,e,8);a.makeParticles(["wood1","wood2","wood3","wood4","dirt2"]),a.bringToTop=!0,a.setAlpha(1,1,3e3),a.setScale(0,.5,0,.5,3e3),a.minParticleSpeed.setTo(-300,-500),a.maxParticleSpeed.setTo(300,100),a.setRotation(-360,360,3e3),a.gravity=400,a.start(!0,3e3,null,50),hits.push(a)}function createBall(t,e){var a=Vent.game.add.emitter(t,e,1);a.makeParticles("ball"),a.bringToTop=!0,a.setAlpha(1,1,3e3),a.setScale(0,2,0,2,3e3),a.minParticleSpeed.setTo(-500,-800),a.maxParticleSpeed.setTo(500,100),a.setRotation(0,180,3e3),a.gravity=400,a.start(!0,3e3,null,50),hits.push(a)}function createSmoke(t,e){var a=Vent.game.add.emitter(t,e,10);a.makeParticles(["smoke1","smoke2","smoke3"]),a.setAlpha(1,0,3e3),a.setScale(0,5,0,5,3e3),a.minParticleScale=0,a.maxParticleScale=4,a.minParticleSpeed.setTo(-200,-200),a.maxParticleSpeed.setTo(200,200),a.setRotation(0,180,3e3),a.start(!0,3e3,null,50),hits.push(a)}function createWave(t,e){var a=Vent.game.add.emitter(t,e,2);a.makeParticles("wave"),a.bringToTop=!0,a.setAlpha(.5,0,1e3),a.setScale(0,.35,0,.35,1e3),a.setRotation(-45,45,1e3),a.gravity=0,a.start(!0,1e3,null,1),hits.push(a)}function updateHits(){var t=0,e=hits.length,a=9;if(e>a)for(var i=e-a,n=0;i>n;n++)hitsToDestroy.push(hits[n]);for(t=i;e>t;t++)updateHit(hits[t]);destroyHits()}function updateHit(t){t.y+=2,t.width+=5,t.height+=5,t.alpha-=.01,t.y>Vent.game.world.height&&hitsToDestroy.push(t)}function updateGuitarVisualization(){var t=playing.length,e=0;if(t>0){for(var a=0;t>a;a++){var i=playing[a].frame,n=playing[a].name;i>=audioData[n].length?playing[a].frame=-1:(playing[a].frame++,e+=Number(audioData[n][i]))}cleanPlayVisual()}add_audio_bar(e)}function add_audio_bar(t){var e=2,a=0,i=t*e,n=barTotal;0==lastY&&0==lastX&&(lastY=i);var r=Vent.game.add.sprite(n,Vent.game.height+a,"square");r.width=3,r.height=i,r.anchor.set(0,1),r.tint=7829367,bars.push(r),bars_group.add(r);var o=Vent.game.add.graphics(0,0);o.lineStyle(3,16777215,1),o.moveTo(lastX,Vent.game.height+a-lastY),o.lineTo(n,Vent.game.height+a-i),bars.push(o),bars_group.add(o),barTotal<Vent.game.width?(barTotal+=5,lastX=n,lastY=i):(bars_reset(),lastX=0,lastY=0)}function bars_reset(){barTotal=0;for(var t=0,e=bars.length;e>t;t++)bars[t].destroy();bars=[],lastY=0,lastX=0}function cleanPlayVisual(){for(var t=0;t<playing.length;t++)-1==playing[t].frame&&(playing.splice(t,1),t-=1)}function destroyAllHits(){for(var t=0,e=hits.length;e>t;t++)hitsToDestroy.push(hits[t]);hits=[],destroyHits()}function destroyHits(){for(var t=0,e=hitsToDestroy.length;e>t;t++)destroyHit(hitsToDestroy[t]);hitsToDestroy=[]}function destroyHit(t){t.destroy();for(var e=0,a=hits.length;a>e;e++)t==hits[e]&&hits.splice(e,1)}var Vent=Vent||{};Vent.Guitar=function(){};var COLOUR_WHITE=16777215,COLOUR_BLACK=0,hitTotal=0,trail=null,trailOn=!1,barTotal=0,buttons,bar_group,bg_guitar_group,hits=[],hitSounds=[],hitsToDestroy=[],playing=[],stopPlaying=[],bars=[],swipeCoordX,swipeCoordY,swipeCoordX2,swipeCoordY2,swipeMinDistance=100,chord1,chord2,chord3,chord4,chord5,drumLoop,graphics=null,bgGame,guitar,hitGoal_txt,sw,sw2,sb,lastX=0,lastY=500,audioLength=100,audioFileName,audioComplete=!1,averages=[],volumes=[],all=[],bounce,bounce_guitar;Vent.Guitar.prototype={create:function(){createGuitarWorldSettings(),bg_guitar_group=Vent.game.add.group(),bgGame=this.game.add.sprite(this.game.width/2,this.game.height/2,"crowd"),bgGame.width=this.game.world.width,bgGame.height=this.game.world.height,bgGame.scale.set(1.2),bgGame.anchor.set(.5),bg_guitar_group.add(bgGame),bgGame.bringToTop(),createCopyright(),createGuitarAudio(),createGuitarUI(),pop=this.game.add.sprite(this.game.width/2,this.game.height/2,"circle"),pop.alpha=0,bg_guitar_group.add(pop),create_guitar_prompt()},update:function(){},render:function(){}};