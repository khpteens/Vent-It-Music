function create_drum_prompt(){var t=Vent.game.add.group(),e=Vent.game.add.graphics(0,0);e.inputEnabled=!0,e.beginFill(0,1),e.boundsPadding=0,e.drawRect(0,0,Vent.game.width,Vent.game.height),e.alpha=0,t.add(e);var a=Vent.game.add.graphics(0,0);a.beginFill(0,1),a.boundsPadding=0,a.drawRect(0,Vent.game.height/2-100,Vent.game.width,200),a.alpha=.5,t.add(a),text="Click the drums",hasTouch&&(text="Tap the drums"),winText=Vent.game.add.text(settings.WIDTH/2,settings.HEIGHT/2-40,text,h3_style_bold),winText.anchor.set(.5),t.add(winText),ContinueBt=Vent.game.add.sprite(settings.WIDTH/2,settings.HEIGHT/2+30,"square"),createBt(ContinueBt,"Continue",!1),ContinueBt.events.onInputUp.add(function(){t.visible=!1},this),t.add(ContinueBt.group),t.bringToTop=!0}function createDrumWorldSettings(){Vent.game.world.setBounds(0,0,settings.WIDTH,settings.HEIGHT),Vent.game.stage.backgroundColor=2236962}function createDrumUI(){createDrumInputListeners(),createDrumButtons()}function createDrumInputListeners(){bgGame.events.onInputDown.add(function(){swipeCoordX=Vent.game.input.activePointer.x,swipeCoordY=Vent.game.input.activePointer.y},this),bgGame.events.onInputUp.add(function(){swipeCoordX2=Vent.game.input.activePointer.x,swipeCoordY2=Vent.game.input.activePointer.y},this)}function createDrumButtons(){buttons=Vent.game.add.group();var t=Vent.game.add.sprite(Vent.game.width-29,29,"square");createBt(t,"icon-x",!1,"circle"),t.events.onInputUp.add(function(){drumExit()}),buttons.add(t),buttons.add(t.label),createDrums()}function createDrums(){var t=Vent.game.add.sprite(Vent.game.width/2-75,Vent.game.height/2+75,"drum-snare");createDrum(t),t.anchor.set(.75,.25),t.events.onInputDown.add(function(){playDrumAudio(beat2)}),buttons.add(t);var e=Vent.game.add.sprite(Vent.game.width/2+75,Vent.game.height/2-75,"drum-small");createDrum(e),e.anchor.set(.25,.75),e.events.onInputDown.add(function(){playDrumAudio(beat3)}),buttons.add(e);var a=Vent.game.add.sprite(Vent.game.width/2+75,Vent.game.height/2+80,"drum-large");createDrum(a),a.anchor.set(.25),a.events.onInputDown.add(function(){playDrumAudio(beat4)}),buttons.add(a);var n=Vent.game.add.sprite(Vent.game.width/2-50,Vent.game.height/2-65,"drum-hat");createDrum(n),n.anchor.set(.75),n.events.onInputDown.add(function(){playDrumAudio(beat1)}),buttons.add(n),stick=Vent.game.add.sprite(0,0,"drumstick"),stick.scale.set(.75),stick.anchor.set(1,.5),stick.visible=!1}function createDrum(t){t.w=t.width,t.h=t.height,t.inputEnabled=!0,t.input.useHandCursor=!0,t.tint=16777215,t.bringToTop(),t.alpha=1,t.events.onInputOver.add(function(){t.alpha=.5}),t.events.onInputOut.add(function(){t.alpha=1}),t.events.onInputDown.add(function(){var e=16777215*Math.random();t.tint=e,t.width=.5*t.w,t.height=.5*t.h,Vent.game.add.tween(t).to({width:t.w,height:t.h,alpha:1},200,Phaser.Easing.Bounce.Out,!0),t.alpha=.5,create_bg_pop(Vent.game.input.activePointer.x,Vent.game.input.activePointer.y,e),createStickAnimation(Vent.game.input.activePointer.x,Vent.game.input.activePointer.y)}),t.events.onInputUp.add(function(){t.alpha=1,t.tint=16777215})}function createStickAnimation(t,e){stick.visible=!0,drumswing&&drumswing.stop(),t<=Vent.game.width/2?(stick.scale.set(-.75),angleMod=-100):(stick.scale.set(.75),angleMod=100),stick.angle=0,stick.x=t+stick.width,stick.y=e,drumswing=Vent.game.add.tween(stick),drumswing.to({angle:stick.angle+angleMod},400,Phaser.Easing.Quadratic.InOut),drumswing.onComplete.addOnce(function(){stick.visible=!1},this),drumswing.start()}function createDrumAudio(){beat1=Vent.game.add.audio("drum4"),beat2=Vent.game.add.audio("drum2"),beat3=Vent.game.add.audio("drum1"),beat4=Vent.game.add.audio("drum3"),guitarLoop=Vent.game.add.audio("guitarLoop"),guitarLoop.loop=!0,guitarLoop.volume=settings.VOLUME,guitarLoop.play(),settings.LOOP=guitarLoop}function createDrumVisualization(){sb=Vent.game.add.sprite(Vent.game.width/2,Vent.game.height/2,"square"),sb.width=Vent.game.width,sb.height=Vent.game.height,sb.anchor.set(.5),sb.tint=4473924,bg_drum_group.add(sb)}function playDrumAudio(t){settings.SOUND_ON&&settings.VOLUME>0&&(t.play(),t.frame=0,playing.push(t))}function drumExit(){Vent.game.input.onDown.removeAll(),Vent.game.input.onUp.removeAll(),guitarLoop.stop(),setTimeout(function(){hitTotal=0,destroyAllHits(),hasTouch?Vent.game.state.start("Finish"):Vent.game.stateTransition.to("Finish")},500)}function create_bg_pop(t,e,a){t||(t=Vent.game.width/2),e||(e=Vent.game.height/2),a||(a=16777215*Math.random()),pop.x=t,pop.y=e,pop.width=pop.height=0,pop.anchor.set(.5),pop.tint=a,pop.alpha=1,Vent.game.add.tween(pop).to({width:900,height:900,alpha:0},1e3,Phaser.Easing.Exponential.Out,!0)}function updateDrumVisualization(){var t=playing.length,e=0;if(t>0){for(var a=0;t>a;a++){var n=playing[a].frame,i=playing[a].name;n>=audioData[i].length?playing[a].frame=-1:(playing[a].frame++,e+=Number(audioData[i][n]))}cleanPlayVisual();var o=.5,r=.01;sb.width=Vent.game.width-e*o,sb.height=Vent.game.height-e*o,sw.width=sw.height=800-5*e,sw.alpha=e*r,sw.rotation+=5,sw2.width=sw2.height=5*e,sw2.alpha=e*r,sw.rotation-=5,sw.tint=sw2.tint=16777215}add_audio_bar(e)}function cleanPlayVisual(){for(var t=0;t<playing.length;t++)-1==playing[t].frame&&(playing.splice(t,1),t-=1)}var Vent=Vent||{};Vent.Drum=function(){};var COLOUR_WHITE=16777215,COLOUR_BLACK=0,hitTotal=0,trail=null,trailOn=!1,barTotal=0,buttons,bar_group,bg_drum_group,hits=[],hitSounds=[],hitsToDestroy=[],playing=[],stopPlaying=[],bars=[],brandColours=[4900843,86165,16541508,16177161,12700963,16777215,0],swipeCoordX,swipeCoordY,swipeCoordX2,swipeCoordY2,swipeMinDistance=100,graphics=null,bgGame,pop,hitGoal_txt,sw,sw2,sb,lastX=0,lastY=500,stick,audioLength=100,audioFileName,audioComplete=!1,averages=[],volumes=[],all=[],guitarLoop,drumswing;Vent.Drum.prototype={create:function(){createDrumWorldSettings(),bg_drum_group=Vent.game.add.group(),bgGame=this.game.add.sprite(this.game.width/2,this.game.height/2,"crowd"),bgGame.width=this.game.world.width,bgGame.height=this.game.world.height,bgGame.scale.set(1.2),bgGame.anchor.set(.5),bg_drum_group.add(bgGame),bgGame.bringToTop(),createDrumAudio(),createDrumUI(),pop=Vent.game.add.sprite(Vent.game.width/2,Vent.game.height/2,"circle"),pop.alpha=0,bg_drum_group.add(pop),create_drum_prompt(),createCopyright()},update:function(){},render:function(){}};